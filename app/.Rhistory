for(i in 2:nrow(X_thermal_g)){
X_thermal_g[i, ] = as.numeric(X_thermal_g_k[i-1, ]) + X_thermal_g[i-1,]
}
X_thermal_g <- X_thermal_g[-1, ]
X_coking_g <- matrix(0, nrow = nrow(X_coking_g_k) + 1, ncol = mines)
for(i in 2:nrow(X_coking_g)){
X_coking_g[i, ] = as.numeric(X_coking_g_k[i-1, ]) + X_coking_g[i-1,]
}
X_coking_g <- X_coking_g[-1, ]
X_thermal <- as.data.frame(X_thermal)
colnames(X_thermal) <- colnames(X)
X_thermal_g_k <- as.data.frame(X_thermal_g_k)
colnames(X_thermal_g_k) <- colnames(X)
X_thermal_g <- as.data.frame(X_thermal_g)
colnames(X_thermal_g) <- colnames(X)
X_coking <- as.data.frame(X_coking)
colnames(X_coking) <- colnames(X)
X_coking_g_k <- as.data.frame(X_coking_g_k)
colnames(X_coking_g_k) <- colnames(X)
X_coking_g <- as.data.frame(X_coking_g)
colnames(X_coking_g) <- colnames(X)
##### Reshaping Data
# Create a vector for the number of years under consideration
years <- c(2011:(2011+N-1))
# Reshape total coal output for ggplot
X <- cbind(years, X)
X <- melt(X, id = "years")
# Reshape coking coal output for ggplot
X_coking <- cbind(years, X_coking)
X_coking <- melt(X_coking, id = "years")
# Reshape thermal coal output for ggplot
X_thermal <- cbind(years, X_thermal)
X_thermal <- melt(X_thermal, id = "years")
g_k <- cbind(years, g_k)
g_k <- melt(g_k, id = "years")
g <- cbind(years, g)
g <- melt(g, id = "years")
X_thermal_g_k <- cbind(years, X_thermal_g_k)
X_thermal_g_k <- melt(X_thermal_g_k, id = "years")
X_thermal_g <- cbind(years, X_thermal_g)
X_thermal_g <- melt(X_thermal_g, id = "years")
X_coking_g_k <- cbind(years, X_coking_g_k)
X_coking_g_k <- melt(X_coking_g_k, id = "years")
X_coking_g <- cbind(years, X_coking_g)
X_coking_g <- melt(X_coking_g, id = "years")
X_plot <- ggplot(X, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("Production in million tons per annum") +
ggtitle("Coal extraction per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
g_k_plot <- ggplot(g_k, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Annual profit per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
g_plot <- ggplot(g, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Cumulative profit") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_thermal_plot <- ggplot(X_thermal, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("Production in million tons per annum") +
ggtitle("Coal extraction per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_thermal_g_k_plot <- ggplot(X_thermal_g_k, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Annual profit per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_thermal_g_plot <- ggplot(X_thermal_g, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Cumulative profit") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_coking_plot <- ggplot(X_coking, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("Production in million tons per annum") +
ggtitle("Coal extraction per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_coking_g_k_plot <- ggplot(X_coking_g_k, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Annual profit per annum") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
X_coking_g_plot <- ggplot(X_coking_g, aes(x = years, y = value, colour = variable)) +
geom_line(size  = 2) +
ylab("profit") +
ggtitle("Cumulative profit") +
theme(plot.title = element_text(hjust = 0.5, face = "bold")) +
theme(panel.background = element_blank(), panel.grid = element_blank(),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black"),
panel.grid.major.y = element_line(linetype = 2, color = "gray"),
axis.title = element_text(face = "bold"),
axis.text = element_text(face = "bold")) +
scale_y_continuous(expand = c(0,0.5)) +
scale_x_continuous(expand = c(0, 0))
return(list(X_plot = X_plot, g_k_plot = g_k_plot, g_plot = g_plot,
X_thermal_plot = X_thermal_plot, X_coking_plot = X_coking_plot,
X_thermal_g_k_plot = X_thermal_g_k_plot, X_coking_g_k_plot = X_coking_g_k_plot,
X_thermal_g_plot = X_thermal_g_plot, X_coking_g_plot = X_coking_g_plot))
}
function(input, output, session) {
plots_DP <- reactive({
simulation_DP_basis(N = input$N,
real_capacity_per_year = real_capacity_per_year,
mines = ncol(real_capacity_per_year),
capacity = input$CPY,
total_capacity_of_mine = c(input$num1, input$num2, input$num3,
input$num4, input$num5, input$num6),
extraction_cost_per_tone = input$C,
alpha_coking = input$alpha_coking,
alpha_thermal = input$alpha_thermal,
b_coking = input$b_coking,
b_thermal = input$b_thermal,
sd_coking = input$sd_coking,
sd_thermal = input$sd_thermal,
rho = c(input$rho1, input$rho2, input$rho3,
input$rho4, input$rho5, input$rho6)
)
})
output$plot <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot1 <- plots_DP()$X_plot
if(input$Coal_Type == "thermal_graphs")
plot1 <- plots_DP()$X_thermal_plot
if(input$Coal_Type == "coking_graphs")
plot1 <- plots_DP()$X_coking_plot
plot1
})
output$g_k_graph <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot2 <- plots_DP()$g_k_plot
if(input$Coal_Type == "thermal_graphs")
plot2 <- plots_DP()$X_thermal_g_k_plot
if(input$Coal_Type == "coking_graphs")
plot2 <- plots_DP()$X_coking_g_k_plot
plot2
})
# Plot the accumulated reward g
output$g_graph <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot3 <- plots_DP()$g_plot
if(input$Coal_Type == "thermal_graphs")
plot3 <- plots_DP()$X_thermal_g_plot
if(input$Coal_Type == "coking_graphs")
plot3 <- plots_DP()$X_coking_g_plot
plot3
})
}
library(markdown)
library(DT)
navbarPage("Coal Mining in Mozambique | DP Algorithm",
tabPanel("Motivation",
includeHTML("about.html")
),
tabPanel("DP Algorithm",
includeHTML("algorithm.html")
),
tabPanel("Modeling",
sidebarLayout(
sidebarPanel(
radioButtons("Coal_Type", "Coal type",
c("Total"="total_graphs",
"Thermal"="thermal_graphs",
"Coking"="coking_graphs")),
radioButtons("CPY", "Capacity per year",
c("Real (constant)"="constant",
"Real (sampling)"="sampling")),
sliderInput("N", label = "Number of Years", min = 20,
max = 100, value = 50),
sliderInput("C", label = "Cost per ton", min = 5,
max = 80, value = 10),
sliderInput("alpha_coking", label = "Mean price coking", min = 102,
max = 170, value = 102),
sliderInput("alpha_thermal", label = "Mean price thermal", min = 63,
max = 110, value = 63),
sliderInput("b_coking", label = "coking price sensibility", min = 0.1,
max = 5, value = 1.5),
sliderInput("b_thermal", label = "thermal price sensibility", min = 0.1,
max = 5, value = 0.8),
sliderInput("sd_coking", label = "coking shocks sd", min = 41 * 0.3,
max = 81 * 0.3, value = 61 * 0.3),
sliderInput("sd_thermal", label = "thermal shocks sd", min = 1 * 0.3,
max = 41 * 0.3, value = 21 * 0.3),
inputPanel(h4("Reserves"),
numericInput("num1",
label = "Ncondezi",
value = 1000,
min = 1000,
max = 10000,
step = 100,
width = "75%"),
numericInput("num2",
label = "Revobue",
value = 1000,
min = 1000,
max = 10000,
step = 100,
width = "75%"),
numericInput("num3",
label = "Zambeze",
value = 900,
min = 900,
max = 1500,
step = 100,
width = "75%"),
numericInput("num4",
label = "Beacon Hill",
value = 360,
min = 360,
max = 1000,
step = 20,
width = "75%"),
numericInput("num5",
label = "Benga",
value = 500,
min = 500,
max = 700,
step = 50,
width = "75%"),
numericInput("num6",
label = "Moatize",
value = 425,
min = 425,
max = 950,
step = 25,
width = "75%")
),
inputPanel(h4("Share of coking coal"),
sliderInput("rho1", label = "Ncondezi", min = 0,
max = 1, value = 0),
sliderInput("rho2", label = "Revobue", min = 0,
max = 1, value = 0.6),
sliderInput("rho3", label = "Zambeze", min = 0,
max = 1, value = 0.6),
sliderInput("rho4", label = "Beacon Hill", min = 0,
max = 1, value = 0.31),
sliderInput("rho5", label = "Benga", min = 0,
max = 1, value = 0.6),
sliderInput("rho6", label = "Moatize", min = 0,
max = 1, value = 0.8)
)
),
mainPanel(
plotOutput("plot"),
plotOutput("g_k_graph"),
plotOutput("g_graph")
))
),
tags$head(tags$style(HTML('
.irs-bar {
background: #fb370b;
border-top:#fb370b;
border-bottom:#fb370b;
}
.irs-bar-edge {
border: #fb370b;
background: #fb370b;
}
.irs-single {
background: #fb370b;
}
'))))
**Motivation**
In 2011, one member of our group was working for the Mozambican Ministry of Planning and Development and was tasked with predicting government revenue from the nascent coal-mining industry. This example uses this scenario as a backdrop for creating a dynamic programming algorithm to model the optimal behaviour of mining companies starting mining operations in Mozambique. While the basic scenario is similar, several assumptions were modified to make the model more tractable.
**Background**
In the late 2000's, just over a decade after the end of a civil war, surveys reported that Mozambique's Tete province was likely to hold the largest untapped coal reserves in the world. This spurred a rush by large multinational mining companies to obtain mining concessions in the region, and the government granted many prospection licences, and a few mining licences. In one of the poorest countries in the world, with an economy dominated until recently by fishing and agriculture, it seemed the country was on the verge of an economic revolution.
Of particular interest was the composition of Mozambican coal: while some of it was thermal coal, which is burned to generate electricity, a large amount was estimated to be coking coal, which is a necessary input into steel-making, by converting it to coke, and using that in turn to remove impurities from iron through chemical reactions. Coking coal is consequently much more valuable than thermal coal, and its price was particularly high in 2011 (when this problem is set) due to the surge in demand for construction steel in China. Naturally, uncertainty exists regarding the sustainability of such high prices in the future, and commodity prices are known for being particularly volatile.
One of the biggest challenges faced by the mining sector, and by government, is that the coal deposits are located in the North-West of the country, far away from sea ports (which were in any case few in the North of the country) and with no proper access routes. For this reason, one mining company, Vale, decided to build its own 900km railway line, across Mozambique and Malawi to Nacala, where they would expand the port. The government also planned to renovate and expand the existing 600km railway line to Beira, in the center of the country. Other options were considered, but were less likely.
This means that in practice, mining companies are faced with a double constraint on their production levels: one is of their own production capacity, and another is the transport capacity to carry the coal to the ports to be exported.
Finally, some coal companies are building energy plants locally to use excess thermal coal that is produced in case it cannot be exported. This would occur when total coal production by all mines is collectively higher than the transport constraint, in which case coking coal will be exported in priority (since it is more valuable), and excess thermal coal will be used in local electricity production, but sold at a discount.
Altogether, these summarise the main variables in our problem:
* There are several mines operating in Mozambique. Here we consider the main 6 mines: Ncondezi, Revobue, Zambeze, Beacon Hill, Benga and Moatize. In our problem, for simplification we assume all mines are owned by the same company.
* Two different products are extracted from coal deposits: coking coal and thermal coal.
* Coking coal is more valuable than thermal coal, and their prices are volatile and uncertain.
* There are annual production capacity constraints for each mine, and a transport constraint on how much coal can be exported from the region overall.
* When coal production is above the transport constraint, coking coal is exported first, and then thermal coal. Excess thermal coal is then sold at a lower salvage price to be used in local thermal energy plants. Coking coal has no salvage price.
![source: Ncondezi](https://raw.githubusercontent.com/drosbcn/coal_dp_app/master/app/moz_map.jpg?token=AAxqqfICKphYGwHSoFfG8DtjdYROUfvcks5Y7g6nwA%3D%3D)
![source: Ncondezi](https://raw.githubusercontent.com/drosbcn/coal_dp_app/master/app/moz_map_2.png?token=AAxqqQ9tkV3FIvSYbKxBsW1FOyvK1Oc-ks5Y7hmmwA%3D%3D)
Access on GIT: https://github.com/drosbcn/coal_dp_app
navbarPage("Coal Mining in Mozambique | DP Algorithm",
tabPanel("Motivation",
includeHTML("about.html")
),
tabPanel("DP Algorithm",
includeHTML("algorithm.html")
),
tabPanel("Modeling",
sidebarLayout(
sidebarPanel(
radioButtons("Coal_Type", "Coal type",
c("Total"="total_graphs",
"Thermal"="thermal_graphs",
"Coking"="coking_graphs")),
radioButtons("CPY", "Capacity per year",
c("Real (constant)"="constant",
"Real (sampling)"="sampling")),
sliderInput("N", label = "Number of Years", min = 20,
max = 100, value = 50),
sliderInput("C", label = "Cost per ton", min = 5,
max = 80, value = 10),
sliderInput("alpha_coking", label = "Mean price coking", min = 102,
max = 170, value = 102),
sliderInput("alpha_thermal", label = "Mean price thermal", min = 63,
max = 110, value = 63),
sliderInput("b_coking", label = "coking price sensibility", min = 0.1,
max = 5, value = 1.5),
sliderInput("b_thermal", label = "thermal price sensibility", min = 0.1,
max = 5, value = 0.8),
sliderInput("sd_coking", label = "coking shocks sd", min = 41 * 0.3,
max = 81 * 0.3, value = 61 * 0.3),
sliderInput("sd_thermal", label = "thermal shocks sd", min = 1 * 0.3,
max = 41 * 0.3, value = 21 * 0.3),
inputPanel(h4("Reserves"),
numericInput("num1",
label = "Ncondezi",
value = 1000,
min = 1000,
max = 10000,
step = 100,
width = "75%"),
numericInput("num2",
label = "Revobue",
value = 1000,
min = 1000,
max = 10000,
step = 100,
width = "75%"),
numericInput("num3",
label = "Zambeze",
value = 900,
min = 900,
max = 1500,
step = 100,
width = "75%"),
numericInput("num4",
label = "Beacon Hill",
value = 360,
min = 360,
max = 1000,
step = 20,
width = "75%"),
numericInput("num5",
label = "Benga",
value = 500,
min = 500,
max = 700,
step = 50,
width = "75%"),
numericInput("num6",
label = "Moatize",
value = 425,
min = 425,
max = 950,
step = 25,
width = "75%")
),
inputPanel(h4("Share of coking coal"),
sliderInput("rho1", label = "Ncondezi", min = 0,
max = 1, value = 0),
sliderInput("rho2", label = "Revobue", min = 0,
max = 1, value = 0.6),
sliderInput("rho3", label = "Zambeze", min = 0,
max = 1, value = 0.6),
sliderInput("rho4", label = "Beacon Hill", min = 0,
max = 1, value = 0.31),
sliderInput("rho5", label = "Benga", min = 0,
max = 1, value = 0.6),
sliderInput("rho6", label = "Moatize", min = 0,
max = 1, value = 0.8)
)
),
mainPanel(
plotOutput("plot"),
plotOutput("g_k_graph"),
plotOutput("g_graph")
))
),
tags$head(tags$style(HTML('
.irs-bar {
background: #fb370b;
border-top:#fb370b;
border-bottom:#fb370b;
}
.irs-bar-edge {
border: #fb370b;
background: #fb370b;
}
.irs-single {
background: #fb370b;
}
'))))
getwd()
setwd("~/GSE/Semester2/Stochastic/coal_dp_app/app")
function(input, output, session) {
plots_DP <- reactive({
simulation_DP_basis(N = input$N,
real_capacity_per_year = real_capacity_per_year,
mines = ncol(real_capacity_per_year),
capacity = input$CPY,
total_capacity_of_mine = c(input$num1, input$num2, input$num3,
input$num4, input$num5, input$num6),
extraction_cost_per_tone = input$C,
alpha_coking = input$alpha_coking,
alpha_thermal = input$alpha_thermal,
b_coking = input$b_coking,
b_thermal = input$b_thermal,
sd_coking = input$sd_coking,
sd_thermal = input$sd_thermal,
rho = c(input$rho1, input$rho2, input$rho3,
input$rho4, input$rho5, input$rho6)
)
})
output$plot <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot1 <- plots_DP()$X_plot
if(input$Coal_Type == "thermal_graphs")
plot1 <- plots_DP()$X_thermal_plot
if(input$Coal_Type == "coking_graphs")
plot1 <- plots_DP()$X_coking_plot
plot1
})
output$g_k_graph <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot2 <- plots_DP()$g_k_plot
if(input$Coal_Type == "thermal_graphs")
plot2 <- plots_DP()$X_thermal_g_k_plot
if(input$Coal_Type == "coking_graphs")
plot2 <- plots_DP()$X_coking_g_k_plot
plot2
})
# Plot the accumulated reward g
output$g_graph <- renderPlot({
if(input$Coal_Type == "total_graphs")
plot3 <- plots_DP()$g_plot
if(input$Coal_Type == "thermal_graphs")
plot3 <- plots_DP()$X_thermal_g_plot
if(input$Coal_Type == "coking_graphs")
plot3 <- plots_DP()$X_coking_g_plot
plot3
})
}
getwd()
shiny::runApp()
runApp()
runApp()
